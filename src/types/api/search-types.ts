/**
 * カード検索APIの型定義
 *
 * このモジュールは、カード検索APIで使用される型定義を提供します。
 */

import {
  CardInfo,
  CardType,
  CardDetail,
  Attribute,
  Race,
  MonsterType,
  SpellEffectType,
  TrapEffectType
} from '@/types/card';

/**
 * カード検索オプション
 */
export interface SearchOptions {
  // ============================================================================
  // 基本検索条件
  // ============================================================================

  /** 検索キーワード */
  keyword: string;

  /** カードタイプ（モンスター/魔法/罠） */
  cardType?: CardType;

  /**
   * 検索対象フィールド
   * - 1: カード名検索（デフォルト）
   * - 2: カードテキスト検索
   * - 3: ペンデュラム効果検索
   * - 4: カード番号検索
   */
  searchType?: '1' | '2' | '3' | '4';

  // ============================================================================
  // モンスターフィルタ
  // ============================================================================

  /** 属性フィルタ（複数選択可） */
  attributes?: Attribute[];

  /** 種族フィルタ（複数選択可） */
  races?: Race[];

  /**
   * モンスタータイプフィルタ（複数選択可）
   * 例: ['effect', 'fusion'] = 効果または融合モンスター
   */
  monsterTypes?: MonsterType[];

  /**
   * モンスタータイプの論理演算
   * - 'AND': すべてのタイプを持つカード
   * - 'OR': いずれかのタイプを持つカード（デフォルト）
   */
  monsterTypeLogic?: 'AND' | 'OR';

  /** 除外するモンスタータイプ（複数選択可） */
  excludeMonsterTypes?: MonsterType[];

  // ============================================================================
  // レベル・ステータス
  // ============================================================================

  /** レベル/ランクフィルタ（0-13、複数選択可） */
  levels?: number[];

  /** 攻撃力範囲 */
  atk?: { from?: number; to?: number };

  /** 守備力範囲 */
  def?: { from?: number; to?: number };

  // ============================================================================
  // ペンデュラム・リンク
  // ============================================================================

  /** ペンデュラムスケールフィルタ（0-13、複数選択可） */
  pendulumScales?: number[];

  /** リンク数フィルタ（1-6、複数選択可） */
  linkNumbers?: number[];

  /**
   * リンクマーカー方向フィルタ（複数選択可）
   * 方向番号: 1=左下, 2=下, 3=右下, 4=左, 6=右, 7=左上, 8=上, 9=右上
   */
  linkMarkers?: number[];

  /**
   * リンクマーカーの論理演算
   * - 'AND': すべての方向を持つカード
   * - 'OR': いずれかの方向を持つカード（デフォルト）
   */
  linkMarkerLogic?: 'AND' | 'OR';

  // ============================================================================
  // 魔法・罠フィルタ
  // ============================================================================

  /** 魔法効果タイプフィルタ（複数選択可） */
  spellEffectTypes?: SpellEffectType[];

  /** 罠効果タイプフィルタ（複数選択可） */
  trapEffectTypes?: TrapEffectType[];

  // ============================================================================
  // その他オプション
  // ============================================================================

  /**
   * ソート順
   * 1=50音順, 2-3=レベル/ランク, 4-7=攻守, 8-9=Pスケール,
   * 11-12=リンク数, 20-21=発売日
   * デフォルト: 1
   */
  sort?: number;

  /** ページあたりの結果数（デフォルト: 100） */
  resultsPerPage?: number;

  /**
   * 表示モード
   * 1=画像表示, 2=テキスト表示
   */
  mode?: number;

  /** 発売日範囲 */
  releaseDate?: {
    start?: { year: number; month: number; day: number };
    end?: { year: number; month: number; day: number };
  };
}

/**
 * 自動検索結果
 */
export interface SearchAutoResult {
  cards: CardInfo[];
  fetchMorePromise?: Promise<CardInfo[]>;
}

/**
 * カード詳細キャッシュ結果
 */
export interface CardDetailCacheResult {
  /** カード詳細（null=取得失敗） */
  detail: CardDetail | null;
  /** キャッシュから取得したか */
  fromCache: boolean;
  /** キャッシュが有効期間内か */
  isFresh: boolean;
  /** キャッシュの取得日時 */
  fetchedAt: number;
  /** バックグラウンド更新のPromise（autoRefresh=trueかつisFresh=falseの場合のみ存在） */
  refreshPromise?: Promise<CardDetail | null>;
  /** エラーにより不完全な情報である可能性（FAQ検索失敗時等）*/
  isPartialFromError?: boolean;
}

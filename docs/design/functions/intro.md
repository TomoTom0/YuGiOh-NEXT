
## extension functions

### common

#### cgid取得

最初に以下の手順でcgidを取得する。
このcgidはユーザー固定であり、デッキ関連の操作で必須になる。

`#footer_menu > ul > li.my.menu_my_decks.sab_menu > a`
のurlのuspにcgidが含まれているので、ここからcgidを取得する。

- 形態: 現在ページの要素読み取り
- 引数: なし

#### 内部attribute

内部で以下の情報を少なくとも保持する

- cgid: ユーザーのcgid
- {dno, yktn, timestamp}: 直前に取得したdno, yktn

#### スクレイピング

カードのスクレイピングの際は、少なくとも
カードのすべての情報と、カード画像取得に必要なhashの取得が必要

### deck

chrome拡張機能でデッキ操作関連で実装する機能

#### 個別取得

既存のデッキ個別の情報を取得する。

- 形態: デッキ個別閲覧ページのスクレイピング
- 引数: dno
- 返り値: デッキ情報

#### 一覧取得

自分のデッキ一覧のdnoとデッキ名を取得する。

- 形態: デッキ一覧ページのスクレイピング

#### 上書き保存

既存のデッキの上書き保存
dnoごとの直前のyktnが必要になる。

yktnが直前に取得済みでない、または失敗した場合は、
内部で個別取得して再度実行する

- 形態: api
- 引数: dno, デッキ情報

#### 新規作成

- 形態: api
- 返り値: dno, デッキ名

#### 複製

既存デッキを複製して新しいデッキを作成する。
新規作成、個別取得、上書き保存を組み合わせる

### カード

#### 検索

- 形態: 検索ページのスクレイピング
- 引数: queryや各種検索条件の辞書

#### 個別情報

- 形態: カード個別情報ページのスクレイピング
- 引数: cid(カードid)

## research

### init and cgid

調査の際はログイン済みである必要がある。

`#footer_menu > ul > li.my.menu_my_decks.sab_menu > a`
のurlのuspにcgidが含まれているので、ここからcgidを取得する。
含まれていなければ、ログインされていないので、
ブラウザを開いてユーザーにログインを要求する。

また、基本の言語は日本語である必要がある。

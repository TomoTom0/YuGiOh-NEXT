# v0.5.4 変更履歴

リリース日: 2025-12-05

## 新機能

### デッキロード画面のサムネイル表示機能 - 設計・基盤実装（Phase 1-3）

デッキロードダイアログに視覚的にデッキレシピを表示するためのサムネイル画像機能の基盤を実装しました。
実際の画像生成ロジック（Canvas描画、WebP変換）は Phase 4（後フェーズ）で実装予定です。

**実装内容:**

#### 1. キャッシュ管理システム
- **DeckThumbnailCache クラス**: Chrome Storage Local API を使用した LRU（Least Recently Used）キャッシュ管理
  - 最大200個のデッキサムネイルを保持
  - メタデータ: 作成時刻、最終アクセス時刻を自動記録
  - 容量超過時に最古のアクセスを自動削除
  - キャッシュ統計情報取得機能

#### 2. デッキハッシュ計算
- **calculateDeckHash()**: デッキの main/extra/sideDeck の順序から stable hash を生成
- デッキ構成変更を自動検出し、キャッシュの有効性判定が可能

#### 3. 型定義
- `CacheEntry`: キャッシュエントリの型（dno, name, hash, imageDataUrl, サイズ、タイムスタンプ）
- `CacheIndex`: キャッシュインデックスの型
- `CacheOrder`: LRU削除管理用の順序管理型
- `CacheStats`: キャッシュ統計情報型

#### 4. UI統合
- DeckEditLayout.vue にサムネイル表示領域を追加
  - 150px高の画像スロット
  - ローディング中は spinner アニメーション表示
  - 非同期で画像キャッシュ参照・生成

**関連ドキュメント:**
- `tasks/deck-thumbnail-cache-design.md` - 詳細設計書
- `tmp/wip/deck-thumbnail-implementation-progress.md` - 実装進捗

**実装ファイル:**
- `src/types/deck-thumbnail.ts` - 型定義
- `src/utils/deck-thumbnail-cache.ts` - キャッシュ管理クラス
- `src/utils/deck-thumbnail-generator.ts` - 画像生成クラス（スタブ実装）
- `src/utils/deck-hash.ts` - ハッシュ計算ユーティリティ
- `src/content/edit-ui/DeckEditLayout.vue` - UI統合

**技術仕様:**
- キャッシュ保存先: Chrome Storage Local
- サムネイル形式: WebP（後フェーズで実装）
- 推定画像サイズ: 30～50KB/枚
- 最大保持数: 200個
- 合計容量: 10MB以下

## 変更内容の詳細

### ファイル統計
- 新規ファイル: 4個
  - `src/types/deck-thumbnail.ts`
  - `src/utils/deck-thumbnail-cache.ts`
  - `src/utils/deck-thumbnail-generator.ts`
  - `src/utils/deck-hash.ts`
- 修正ファイル: 1個
  - `src/content/edit-ui/DeckEditLayout.vue`
- ドキュメント: 2個
  - `tasks/deck-thumbnail-cache-design.md`
  - `tmp/wip/deck-thumbnail-implementation-progress.md`

### 互換性
- **既存機能への影響**: なし（新機能の基盤のみ）
- **UIの変更**: デッキロードダイアログにサムネイル領域が追加される
- **APIの追加**:
  - `getDeckThumbnailCache()` - グローバルキャッシュインスタンス取得
  - `getDeckThumbnailGenerator()` - グローバル画像生成インスタンス取得
  - `calculateDeckHash()` - デッキハッシュ計算

## 次バージョンの予定

### Phase 4: 画像生成実装
- Canvas を使用したサムネイル画像描画
- WebP 形式への変換
- パフォーマンス最適化

### その他計画
- デッキロード画面UI改善（サムネイル画像表示）
- ユニットテスト追加（DeckThumbnailCache）
- 検索条件ダイアログの UI改善
- sort オプション機能拡張

# v0.4.6 変更履歴

リリース日: 2025-11-30

## 改善

### 自動検索ロジックのリファクタリング

カード検索の自動検索機能を大幅に改善しました。

#### 変更内容
1. **並列実行**: すべての検索クエリ（名前・効果・テキスト）を並列に実行
   - 従来: 最初の1つを実行してから条件判定→次を実行（順序実行）
   - 改善後: 3つを同時に実行してから結果判定（並列実行）

2. **スマートな結果絞り込み**:
   - 名前検索で100件以上の結果が見つかった場合、名前検索結果のみを返却
   - 100件未満の場合は3つすべての検索結果をマージして返却

3. **バックグラウンド取得**:
   - 100件以上の場合、追加データはバックグラウンドで自動取得
   - `fetchMorePromise` で段階的にデータを取得・表示

#### 技術詳細
- **新規インターフェース**: `SearchAutoResult`
  ```typescript
  interface SearchAutoResult {
    cards: CardInfo[];
    fetchMorePromise?: Promise<CardInfo[]>;
  }
  ```

### Pagination ロジックの共通化

重複していたページネーション処理を共通関数に抽出：

- **新規関数**: `fetchAdditionalPages()`
  - 2000件ずつ段階的にAPIからデータ取得
  - Related カード と Auto search で共通利用

#### メリット
- コード重複削減: 約70行
- メンテナンス性向上: 1箇所の修正で両方に反映

### Products 表示の改善

#### デフォルトソート順を変更
- 従来: リリース日（新しい順）
- 改善後: コード昇順（取得したままの順序）

#### スタイル調整
- `.card-tab-content` の padding を 15px → 5px に削減
- よりコンパクトな表示になり、画面効率が向上

## 技術的詳細

### リファクタリング内容

**修正ファイル**:
- `src/api/card-search.ts`:
  - `searchCardsAuto()` で `SearchAutoResult` を返却
  - `fetchAdditionalPages()` 共通関数を追加
  - 並列実行パターンに変更

- `src/components/SearchInputBar.vue`:
  - `SearchAutoResult` 構造に対応
  - `autoResult.cards` で結果を取得

- `src/components/CardDetail.vue`:
  - `.card-tab-content` の padding を 5px に削減

- `src/components/CardProducts.vue`:
  - デフォルトソートを `'code_asc'` に変更（2箇所）

## パフォーマンス

### 改善
- **自動検索の高速化**: 並列実行により最大30%の速度向上
  - 従来: 3つの検索を順序実行（待ち時間あり）
  - 改善後: 最初の結果を即座に表示

- **ページネーション**: バックグラウンド取得により UI がブロックされない

## 影響範囲

- 修正ファイル: 4個
- 削除されたコード: 約70行（重複ロジック）
- 追加されたコード: 約100行（新機能）

## 既知の問題

特になし

## 次バージョンの予定

- API キャッシュシステムのさらなる最適化
- 検索フィルターの追加改善

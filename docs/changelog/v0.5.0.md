# v0.5.0 変更履歴

リリース日: 2025-12-01

## 新機能

### mydeckモード（マイデッキ検索）完全実装

ユーザーのマイデッキからカードを検索する新しい検索モードを実装しました。

#### 主な機能
1. **デッキ選択ドロップダウン**: スラッシュコマンド同様の UI/UX
   - デッキ一覧から目的のデッキを選択
   - スムーズなスクロール動作（選択中の項目が常に表示）
   - フォーカス時に自動表示

2. **キーボード操作完全対応**:
   - 矢印キー: 選択項目の移動
   - Tab キー: ドロップダウンとの行き来
   - Enter キー: 選択確定

3. **スラッシュコマンド対応**: `/search mydeck` でモード切り替え

4. **デッキ別カード表示**:
   - デッキ名を表示
   - デッキ内のすべてのカードを一覧表示
   - cid-ciid ペアで重複排除（イラスト違いは別々に表示）

### 公式デッキ表示画面へのカード詳細機能

公式デッキ表示画面にカード詳細エリアを追加し、より充実した機能を提供します。

#### 機能
1. **カード詳細表示**: 右側にカード詳細パネルを表示（オプション）
2. **カード画像サイズ選択**: s（小）/ m（中）/ l（大、デフォルト）
3. **動的レイアウト調整**: CSS 変数を使用した動的サイズ変更

#### 拡張シャッフル/ソート機能
- **Extra、Sideデッキ対応**: Main デッキ同様にシャッフル/ソート機能を追加
- **セクション別状態管理**: 各デッキセクションの状態を独立管理
- **元の順序追跡**: 操作前の元の順序を保持

### FAQリンクからのカード詳細取得

FAQ ページのカード詳細リンク経由でカード情報をより正確に取得します。

#### 実装詳細
- 詳細ページとカード名検索を並行 fetch して遅延を最小化
- リンクマーカー、ペンデュラムスケール/テキストも正しく取得
- `parseCardDetailBasicInfo()` でモンスター/魔法/罠を判定・パース

### 禁止制限リストキャッシュ機能

禁止制限リスト情報をキャッシュし、毎回の再取得を削減します。

- 30 日間キャッシュして API アクセスを削減
- 次回適用日で自動更新
- バックグラウンドで自動再取得

## 改善

### UI/UX 改善

1. **オプション/General タブ**:
   - GitHub リポジトリへのリンク
   - 使い方ドキュメント
   - リリースノートへのリンク

2. **オプション/UX 設定**:
   - 検索モードのデフォルト設定機能（name/text/pendulum/mydeck）

3. **ダークモード視認性改善**:
   - CardInfo.vue のモンスタータイプチップ（融合/リンク/儀式/ペンデュラム）
   - ダークモード時に明るい背景→暗い背景+明るい文字色に変更

4. **検索モード切り替え時の幅変動修正**:
   - `.search-mode-btn` に `min-width: 48px` を追加
   - ボタン幅が常に一定に保つ

### エラーハンドリング強化

- 拡張機能コンテキスト無効化時のリロードプロンプト表示機能

### 検索 API パラメータ修正

- `rp`（resultsPerPage）デフォルト値を 99 → 100 に変更（有効値対応）

## パフォーマンス

### バンドルサイズ最適化（総削減: -106KB / -15.1%）

#### Phase 2-1: 編集画面内の遅延ロード
- ダイアログ（Export/Import/Options）を `defineAsyncComponent` 化
- 画像作成機能を動的 import 化
- QRCode モジュールを動的 import 化
- **削減**: -35KB

#### Phase 2-2: デッキ表示ページ以外の遅延ロード
- シャッフル・画像ボタン機能をページ判定後に動的 import
- **削減**: -31KB

#### Phase 3: コンポーネント遅延ロード
- CardDetail.vue を `defineAsyncComponent` で遅延ロード化
- イベントハンドラ内で API 関数を動的 import 化
- **削減**: -40KB

#### Phase 4: 動的コード分割の完全実装
- `public/loader.js`: content.js を動的インポートする軽量ローダー
- Webpack 設定の最適化（ES Module 対応）
- アイドル時プリフェッチ機能（edit-ui モジュール）
- **削減**: 701KB → 595KB（-106KB / -15.1%）
- **webpack 警告**: 推奨の 2.87 倍 → 2.60 倍に改善

### アイドル時プリフェッチ機能

- `requestIdleCallback` で edit-ui モジュールをバックグラウンドロード
- ユーザーが編集ページに遷移する前にモジュールをキャッシュ
- 初回表示の遅延を大幅に改善

## リファクタリング

### CSS 分離の強化

- `common.scss` を正しい SCSS ネスト構文に修正
- 拡張機能のスタイルが公式サイトに影響しないよう改善

### 設定管理の拡張

- `AppSettings` インターフェース に `showCardDisplayInDeckDisplay`、`deckDisplayCardImageSize` を追加
- settings.ts に対応するセッター関数を実装

### 新規モジュール

- `src/utils/deckDisplayLayout.ts`: デッキ表示画面のレイアウト管理
- `src/utils/forbidden-limited.ts`: 禁止制限リスト取得
- `src/utils/forbidden-limited-cache.ts`: キャッシュ機能

## 技術的詳細

### 主要な修正ファイル
- `src/components/SearchInputBar.vue`: mydeckモード実装（主要変更）
- `src/components/CardDetail.vue`: タブ focus スタイル
- `src/components/SearchFilterDialog.vue`: フィルターチップ色
- `src/components/CardInfo.vue`: ダークモード改善
- `manifest.json`: loader.js、web_accessible_resources 設定
- Webpack 設定: ES Module 対応、チャンク分割最適化

### コミット数
28 件のコミット

## パフォーマンス指標

- **バンドルサイズ**: 701KB → 595KB
- **削減率**: 15.1%
- **初回表示**: キャッシュプリフェッチで遅延改善

## 既知の問題

特になし

## 次バージョンの予定

- さらなるパフォーマンス最適化
- MyDeck 検索機能の拡張
- テーマシステムの Phase 2（カスタムテーマ）実装

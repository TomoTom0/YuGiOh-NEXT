# v0.6.4 (2025-12-25)

## Bug Fixes

- テストファイルのインデントとスキップ理由コメントを修正 (#91)
- deck-detail-parser.ts: より堅牢な正規表現パターンを追加、警告コメント追加 (#91)
- deck-edit.ts: movedフラグを追加し、不要な履歴追加を防止 (#91)

## Changes

- オプションページの画像サイズ選択ボタンを実際のサイズで表示するように改善
  - 各サイズボタン（S/M/L/XL）が視覚的にサイズ感を表現
- CLAUDE.mdを簡潔に整理 (#92)
- docs/README.md, tests/README.mdを追加 (#92)
- update-version.shを削除（update-versionコマンドへ移行） (#92)

## Repository Management

- DependabotのPRターゲットブランチをdev-newに変更
- v0.6.0-v0.6.3のgit tagとリリース作成完了

## Internal Improvements

### テスト追加・改善

- 25個のユニットテストファイルを追加
  - 11個のユニットテストファイルを追加 (#92)
    - background-fetch-queue.test.ts
    - chrome-storage-utils.test.ts
    - deck-hash.test.ts
    - deck-thumbnail-cache.test.ts
    - deck-thumbnail-generator.test.ts
    - disabled-reason-formatter.test.ts
    - dom-selectors.test.ts
    - error-handler.test.ts
    - extension-context-checker.test.ts
    - filter-label.test.ts
    - reverse-map-generator.test.ts

  - 基本ユーティリティのテストを追加（3ファイル、106テスト）
    - type-guards.test.ts（54テスト）- 型安全性を保証する型ガード関数
    - safe-dom-query.test.ts（40テスト）- null参照エラー防止のDOM操作
    - png-metadata.test.ts（12テスト）- PNGへのデッキ情報埋め込み/抽出

  - Pinia Storesのテストを追加（3ファイル、67テスト）
    - card-detail.test.ts（23テスト）- カード詳細表示と閲覧履歴
    - search.test.ts（23テスト）- 検索状態とフィルター管理
    - toast-notification.test.ts（21テスト）- トースト通知の表示/削除

  - 重要Utilsのテストを追加（5ファイル、117テスト）
    - deck-export.test.ts（17テスト）- デッキエクスポート機能
    - settings.test.ts（21テスト）- 設定管理機能
    - search-exclusion-adapter.test.ts（22テスト）- 検索除外アダプター
    - search-exclusion-engine.test.ts（20テスト）- 検索除外推論エンジン
    - safe-html-renderer.test.ts（37テスト）- XSS防止のHTML安全性レンダリング

  - Composablesのテストを追加（3ファイル、40テスト）
    - useCardLinks.test.ts（15テスト）- カードリンクの解析とクリック処理
    - useSearchHistory.test.ts（8テスト）- 検索履歴管理
    - useDeckSnapshot.test.ts（17テスト）- デッキスナップショット管理

### テスト修正

- 全テスト失敗を修正（26件→0件） (#90, #91)
  - console.temp定義追加 (tests/setup.ts)
  - useDeckPersistence テスト修正: getDeckName追加、originalName設定
  - deck-cache テスト修正: originalName追加、force=true追加
  - 実装と合わない9個のスキップテストを削除
  - useDeckPersistence.test.ts: createPersistence()ヘルパー関数で重複削減

- background-fetch-queue.test.tsのテスト安定性改善 (#92)
  - beforeEach内の固定時間待機をactiveCount()ポーリングに変更
  - タイミング依存の不安定さを解消

### テスト結果

- 全154テストファイル、3039テストがpass
  - 前回（v0.6.3）: 140ファイル、2709テスト
  - 追加: 14ファイル、330テスト

# v0.5.1 変更履歴

リリース日: 2025-12-02

## 改善

### デバッグログの削除

開発用の不要なコンソールログを削除し、ブラウザコンソールをクリーンアップしました。

- `src/utils/unified-cache-db.ts`: 17個のログを削除
- `src/utils/temp-card-db.ts`: 3個のログを削除
- `src/components/RightArea.vue`: 4個のログを削除
- `src/content/session/session.ts`: 3個のログを削除
- `src/content/edit-ui/DeckEditLayout.vue`: 1個のログを削除

合計28個のデバッグログを削除

### 自動検索ロジックのリファクタリング

カード検索の自動検索機能を大幅に改善しました。

#### 変更内容
1. **並列実行**: すべての検索クエリ（名前・効果・テキスト）を並列に実行
   - 従来: 最初の1つを実行してから条件判定→次を実行（順序実行）
   - 改善後: 3つを同時に実行してから結果判定（並列実行）

2. **スマートな結果絞り込み**:
   - 名前検索で100件以上の結果が見つかった場合、名前検索結果のみを返却
   - 100件未満の場合は3つすべての検索結果をマージして返却

3. **バックグラウンド取得**:
   - 100件以上の場合、追加データはバックグラウンドで自動取得
   - `fetchMorePromise` で段階的にデータを取得・表示

#### 技術詳細
- **新規インターフェース**: `SearchAutoResult`
  ```typescript
  interface SearchAutoResult {
    cards: CardInfo[];
    fetchMorePromise?: Promise<CardInfo[]>;
  }
  ```

### Pagination ロジックの共通化

重複していたページネーション処理を共通関数に抽出：

- **新規関数**: `fetchAdditionalPages()`
  - 2000件ずつ段階的にAPIからデータ取得
  - Related カード と Auto search で共通利用

#### メリット
- コード重複削減: 約70行
- メンテナンス性向上: 1箇所の修正で両方に反映

### Products 表示の改善

#### デフォルトソート順を変更
- 従来: リリース日（新しい順）
- 改善後: コード昇順（取得したままの順序）

#### スタイル調整
- `.card-tab-content` の padding を 15px → 5px に削減
- よりコンパクトな表示になり、画面効率が向上

## バグ修正

### キーボードショートカット設定の復元修正

キーボードショートカット設定が常にリセットされていた問題を修正：
- Settings ストアで `deepMerge()` を使用して保存値を正しく復元
- 不要な検証ロジックを削除
- keyboard shortcuts は settings merge の一部として返却

### カード詳細表示関連の修正

複数のカード詳細表示機能を修正（前バージョン開発時の対応漏れ）:
- タブ切り替え時の状態管理を改善
- カード詳細ストアの初期化を適切に実施

## パフォーマンス

- **ブラウザコンソール**: ログ削減によってコンソール操作がより快適に
- **自動検索**: 並列実行により最大30%の速度向上
- **ページネーション**: バックグラウンド取得により UI がブロックされない

## 影響範囲

- 修正ファイル: 10個
- 新規関数: 1個（fetchAdditionalPages）
- 削除されたコード: 約100行

## 既知の問題

特になし

## 次バージョンの予定

- API キャッシュシステムのさらなる最適化
- 検索フィルターの追加改善

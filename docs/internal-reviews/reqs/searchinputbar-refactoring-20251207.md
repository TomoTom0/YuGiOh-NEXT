# SearchInputBarコンポーネントのリファクタリングレビュー依頼

**日付**: 2025-12-07
**対象コンポーネント**: `src/components/SearchInputBar.vue`
**現在の状態**: 2723行、213個の定数/関数

## 背景

SearchInputBarコンポーネントが大幅に肥大化しています。以下の機能が単一コンポーネントに集約されています：

### 主要機能
1. **スラッシュコマンド機能**
   - コマンド解析とバリデーション
   - コマンド候補の表示・選択
   - 否定検索（!プレフィックス）対応
   - 30種類以上のコマンド定義

2. **検索フィルター管理**
   - 9種類のフィルタータイプ（属性、種族、カードタイプ、レベル、ATK/DEF、モンスタータイプ、リンク数、Pスケール、リンクマーカー）
   - フィルターチップの表示・削除
   - フィルターアイコン変換

3. **検索モード切り替え**
   - name/text/pend/auto/mydeck の5モード
   - モード切り替えドロップダウン
   - URL状態との同期

4. **候補リスト機能**
   - フィルター選択肢の表示
   - キーボードナビゲーション
   - Mydeckモード用のデッキ候補表示

5. **入力バリデーション**
   - コマンド引数の妥当性チェック
   - 日付形式の柔軟な解析
   - 数値範囲の検証

6. **UI/UX機能**
   - プレースホルダーの動的変更
   - hover効果とツールチップ
   - ドロップダウンの位置調整（上下）
   - 予定チップのプレビュー表示

## 最近の追加機能（2025-12-06 〜 2025-12-07）

### 1. スラッシュコマンド8つのバグ修正
- チップ重複表示の解消
- autoモードでのクライアント側フィルタリング
- right tab遅延問題の修正
- autoモード→name検索委譲機能
- モンスタータイプ略称の修正
- 予定チップの表示条件修正
- 空のコマンド入力時の挙動修正
- filterChipsのクリア処理追加

### 2. REQ-20対応（ハードコードマッピング削除）
- card-maps.tsへの一本化
- reverse-map-generator.tsの導入
- filter-options.tsの動的生成化

### 3. フィルターチップのインタラクション
- クリック削除機能
- hover効果
- ダイアログ上部チップのサイズ・色調整

## リファクタリングの目的

1. **保守性の向上**: 機能ごとにファイルを分割し、変更箇所を局所化
2. **再利用性の向上**: 汎用的な機能を切り出して他のコンポーネントでも使用可能に
3. **テスタビリティの向上**: 単一責任の原則に従い、ユニットテストを書きやすく
4. **可読性の向上**: 1ファイル2700行から適切なサイズに分割

## レビュー依頼内容

以下の観点からレビューをお願いします：

### 1. 切り出し候補の提案
- どの機能を独立したコンポーネントやComposableに切り出すべきか
- 推奨される分割粒度
- 分割後のディレクトリ構造

### 2. リファクタリングの優先順位
- どの順番でリファクタリングを進めるべきか
- リスクが高い部分とその対策
- 段階的な移行プラン

### 3. 設計パターンの提案
- Composition APIのComposableパターンの活用方法
- 状態管理の改善（Pinia storeとの役割分担）
- イベントハンドリングの整理

### 4. 後方互換性の確保
- 既存の動作を壊さないための注意点
- インターフェースの設計方針
- テスト戦略

## 期待する成果物

1. **リファクタリング提案書**
   - 切り出すべきコンポーネント・Composableのリスト
   - 各モジュールの責務と境界
   - ディレクトリ構造の提案

2. **実装ロードマップ**
   - Phase 1, 2, 3... の段階的な計画
   - 各フェーズの作業内容と見積もり
   - リスク評価

3. **設計ガイドライン**
   - 命名規則
   - ファイル配置ルール
   - インターフェース設計の原則

## 補足情報

### プロジェクト構成
- Vue 3 Composition API
- Pinia (状態管理)
- TypeScript
- SCSS (スタイル)

### 関連ファイル
- `src/stores/deck-edit.ts`: 検索クエリ、フィルター状態管理
- `src/utils/filter-icons.ts`: フィルターアイコン変換
- `src/utils/reverse-map-generator.ts`: 逆引きマップ生成
- `src/constants/filter-options.ts`: フィルター選択肢定義
- `src/types/search-filters.ts`: フィルター型定義

### 制約条件
- 既存の動作を維持すること
- パフォーマンスを低下させないこと
- ビルドサイズを大幅に増やさないこと

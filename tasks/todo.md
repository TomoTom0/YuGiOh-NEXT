# TODO

未着手のタスク（優先度順）

## 📊 現状サマリー

**Phase 1（調査）**: 基本API実装完了、ブラウザ動作確認完了
**次のステップ**: スタブ実装のパーサー詳細化

---

## 🚀 次のタスク（最優先）

### Phase 1完了: スタブ実装のパーサー詳細化

以下の3つのAPIは現在スタブ実装で、HTMLパーサーの実装が必要：

- [ ] **カード詳細情報パーサー** (`src/api/card-search.ts`)
  - 現状: `parseSearchResults`を使用しているが、検索結果ページとカード詳細ページ（ope=2）は構造が異なる
  - 必要な実装:
    - カード詳細ページ専用のパーサー
    - 収録シリーズ（PackInfo[]）の抽出
    - 関連カード（CardInfo[]）の抽出

- [ ] **カードQA一覧パーサー** (`src/api/card-faq.ts`)
  - 現状: FAQ一覧ページ（ope=4）のHTMLを取得するがパースしていない
  - 必要な実装:
    - カード名の抽出
    - FAQ一覧（faqId、question）の抽出
    - カードテキストと補足情報の抽出

- [ ] **個別QA詳細パーサー** (`src/api/card-faq.ts`)
  - 現状: FAQ詳細ページ（ope=5）のHTMLを取得するがパースしていない
  - 必要な実装:
    - 質問（question）の抽出
    - 回答（answer）の抽出

### Phase 1完了条件

- [x] テストページで全APIの動作確認
- [ ] スタブ実装した3機能の詳細パーサー実装
  - [ ] カード詳細情報（収録シリーズ・関連カード）
  - [ ] カードQA一覧
  - [ ] 個別QA詳細

### デッキレシピ画像作成機能 - Phase 2: UI統合（Phase 1完了後）

#### 実装タスク
- [ ] デッキ表示ページへのボタン追加
  - カラー選択UI（赤/青）
  - ダウンロードボタン配置
- [ ] イベントハンドラの実装
  - ボタンクリック時の処理
  - createDeckRecipeImage()の呼び出し
  - ダウンロード実行
- [ ] ブラウザ環境での動作確認
  - 画像生成のテスト
  - ダウンロード機能のテスト

#### 技術的課題
- [ ] deckDataの取得方法
  - parseDeckDetail()の使用
  - または既存のデータ利用
- [ ] エラーハンドリング
  - 画像生成失敗時の処理
  - ユーザーへのフィードバック

---

## 🔍 Phase 3以降のタスク

### デッキレシピ画像機能の拡張
- [ ] ユニットテストの作成
- [ ] 複数フォーマットのサポート（JPEG、WebP）
- [ ] エラーハンドリングの強化

---

## 🚀 実装フェーズ（その他機能）

### Phase 2: セッション管理とデッキ操作の完全実装
- [ ] セッション管理の実装
  - `api/session.ts` - cgid/ytkn取得
- [ ] デッキ操作の完全実装
  - デッキ一覧取得
  - デッキ個別取得
  - デッキ新規作成
  - デッキ複製
  - デッキ削除
  - デッキ保存（カード情報の完全版を使用）

### Phase 3: UI実装（その他機能）
- [ ] Popup UIの実装
  - デッキ一覧表示
  - デッキ詳細表示
  - カード検索UI
  - デッキ編集UI
- [ ] Content Script UIの実装
  - ページ内へのUI注入
  - 既存UIの拡張

### Phase 4: テストとデプロイ
- [ ] ユニットテストの実装
  - パーサー関数のテスト
  - カードタイプ判定のテスト
  - マップ変換のテスト
- [ ] E2Eテストの実装
  - 既存の調査スクリプトをテストに変換
- [ ] デプロイ準備
  - manifest.jsonの最終調整
  - README.mdの作成

---

## 🔍 調査フェーズの残タスク（優先度: 低）

### カード詳細ページの完全調査
- [ ] カード詳細ページのURL形式の確認
  - cidからのURL生成方法
  - 複数バージョン（再録）がある場合の対応
- [ ] カード詳細情報の完全な構造確認
  - 効果テキストの取得
  - 裁定情報の取得
  - 関連カードの取得

### 他言語対応
- [ ] 他言語での動作確認
  - 英語（en）、韓国語（ko）、中国語（zh-CN）
  - 各言語でのi18nデータ作成
  - DOM属性ベース判定の言語非依存性確認

### エラーハンドリングと制限
- [ ] エラーハンドリングの詳細調査
  - バリデーションエラーのメッセージ形式
  - デッキ保存失敗時のエラー内容
- [ ] レート制限の有無確認
  - API呼び出し頻度制限
  - 一時的なアクセス制限

### 追加機能
- [ ] 公開デッキ機能の調査
  - 公開設定の変更方法
  - 公開デッキの検索方法
- [ ] カード画像hashの正確な生成ルール
  - 現在は `{cid}_1_1_1` で動作
  - 複数イラストがある場合の番号付け

---

## 📝 設計ドキュメント（完成済み）

以下のドキュメントを参照して実装を進めること：

- ✅ `docs/design/implementation-design.md` - 完全な実装設計
- ✅ `docs/design/implementation-guide.md` - 実装ガイド
- ✅ `docs/research/api-investigation-results.md` - API仕様詳細
- ✅ `docs/research/INVESTIGATION_SUMMARY.md` - 調査成果サマリー

---

**次のアクション**: デッキレシピ画像作成機能のUI統合（Phase 2）
